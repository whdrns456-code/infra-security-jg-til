Markdown
# π“… TIL: 2026-02-25

## π“ 1. μ¤λμ ν•™μµ μ£Όμ  λ° ν•µμ‹¬ λ‚΄μ©
- **μ£Όμ” μ£Όμ : HAProxyλ¥Ό μ΄μ©ν• SSL Termination λ° L7 λ΅λ“λ°Έλ°μ‹± κµ¬μ„±**
- **ν•µμ‹¬ κ°λ… 1: SSL Termination (SSL Offloading)**
    - λ‚΄μ©: μ™Έλ¶€(Client)μ™€ λ΅λ“λ°Έλ°μ„ μ‚¬μ΄λ” HTTPS(443)λ΅ μ•”νΈν™” ν†µμ‹ μ„ ν•κ³ , λ΅λ“λ°Έλ°μ„μ™€ λ‚΄λ¶€ μ„λ²„ μ‚¬μ΄λ” HTTP(80) ν‰λ¬ΈμΌλ΅ ν†µμ‹ ν•μ—¬ μ„λ²„μ λ¶€ν•λ¥Ό μ¤„μ΄κ³  κ΄€λ¦¬λ¥Ό μΌμ›ν™”ν•λ” λ°©μ‹.
- **ν•µμ‹¬ κ°λ… 2: Self-signed Certificate & PEM νμΌ**
    - λ‚΄μ©: μ‚¬μ„¤ μΈμ¦μ„λ¥Ό μƒμ„±ν•κ³ , HAProxyμ—μ„ μ‚¬μ©ν•κΈ° μ„ν•΄ μΈμ¦μ„(.crt)μ™€ κ°μΈν‚¤(.key)λ¥Ό ν•λ‚μ .pem νμΌλ΅ ν•©μ³μ„ κ΄€λ¦¬ν•¨.
- **ν•µμ‹¬ κ°λ… 3: ν¬νΈ μ¶©λ λ° μ μ  ν™•μΈ**
    - λ‚΄μ©: λ™μΌν• IPμ νΉμ • ν¬νΈ(443)λ” ν•λ‚μ μ„λΉ„μ¤λ§ μ μ ν•  μ μμ. `ss -tulpn` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ ν¬νΈ μ μ  μƒνƒλ¥Ό ν™•μΈν•κ³  μ¶©λμ„ ν•΄κ²°ν•¨.

---

## π’» 2. μ‹¤μµ λ° κµ¬ν„ λ‚΄μ©
### β… μ‹¤μµ λ©ν‘
- HAProxyλ¥Ό ν†µν•΄ 1κ° IPμ—μ„ 80/443 ν¬νΈλ¥Ό λ¦¬μ¨ν•κ³ , 3κ°μ κ°€μƒ IPλ΅ μ΄μλλ” Apache μ„λ²„λ΅ νΈλν”½μ„ λ¶„μ‚°ν•¨.

### π› οΈ κµ¬ν„ κ²°κ³Ό (ν•µμ‹¬ λ…λ Ήμ–΄ λ° μ„¤μ •)


```bash
# 1. μΈμ¦μ„ μƒμ„± λ° κ²°ν•©
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/ssl/server.key \
-out /etc/ssl/server.crt \
-subj "/C=KR/ST=Seoul/L=Seoul/O=JG/OU=IT/CN=192.168.100.136"

cat /etc/ssl/server.crt /etc/ssl/server.key > /etc/ssl/server.pem

# 2. HAProxy μ„¤μ • (/etc/haproxy/haproxy.cfg)
# frontend main
#     bind 192.168.100.136:80
#     bind 192.168.100.136:443 ssl crt /etc/ssl/server.pem
#     http-request redirect scheme https if !{ ssl_fc }
#     default_backend app
#
# backend app
#     balance roundrobin
#     server app1 192.168.100.230:80 check
#     server app2 192.168.100.240:80 check
#     server app3 192.168.100.250:80 check
β¨ μƒλ΅­κ² μ•κ² λ μ 
SSL Terminationμ ν¨μ¨μ„±: κ° μ›Ή μ„λ²„λ§λ‹¤ SSL μ„¤μ •μ„ ν•  ν•„μ” μ—†μ΄ λ΅λ“λ°Έλ°μ„ ν• κ³³μ—μ„λ§ κ΄€λ¦¬ν•λ©΄ λλ―€λ΅ μ΄μ ν¨μ¨μ΄ κ·Ήλ€ν™”λ¨μ„ λ°°μ›€.

μ•„νμΉ μ„¤μ •μ μ μ—°μ„±: ν™•μ¥μλ¥Ό .bakμΌλ΅ λ³€κ²½ν•μ—¬ λ¶ν•„μ”ν• μ„¤μ • νμΌ(ssl.conf)μ„ μ†μ‰½κ² λΉ„ν™μ„±ν™”ν•λ” νΈλ¦­μ„ μµν.

π› οΈ 3. νΈλ¬λΈ”μν… (Troubleshooting)
π” λ¬Έμ  λ°μƒ (Issue)
μƒν™©: HAProxy μ„¤μ • ν›„ μ¬μ‹μ‘ μ‹ Job for haproxy.service failed μ—λ¬ λ°μƒ.

μ—λ¬ λ©”μ‹μ§€: cannot bind socket (Address already in use) for [192.168.100.136:443]

π’΅ μ›μΈ λ¶„μ„ (Cause)
κΈ°μ΅΄μ— μ„¤μΉλ mod_ssl ν¨ν‚¤μ§€λ΅ μΈν•΄ Apache(httpd)κ°€ λ¨λ“  μΈν„°νμ΄μ¤μ 443 ν¬νΈλ¥Ό λ―Έλ¦¬ μ μ ν•κ³  μμ—μ.

π€ ν•΄κ²° λ°©λ²• (Solution)
grep -r "Listen 443" /etc/httpd/λ΅ μ„¤μ • μ„μΉ ν™•μΈ.

/etc/httpd/conf.d/ssl.confμ ν™•μ¥μλ¥Ό .bakμΌλ΅ λ³€κ²½ν•μ—¬ Apacheμ 443 μ μ λ¥Ό ν•΄μ ν•¨.

systemctl restart httpd ν›„ HAProxy μ¬μ‹μ‘ μ„±κ³µ.

π§ 4. μ¤λμ νκ³ 
π’΅ μ„±μ°° λ° μ„±μ¥
μµλ“ μ§€μ‹: λ¦¬λ…μ¤ λ„¤νΈμ›ν¬ μ„λΉ„μ¤ κ°„μ ν¬νΈ κ°„μ„­ μ›λ¦¬λ¥Ό λ…ν™•ν μ΄ν•΄ν•κ² λμ—κ³ , μ„λΉ„μ¤ μ¥μ•  μ‹ λ΅κ·Έ(-db μµμ… λ“±)λ¥Ό ν™•μΈν•λ” λ””λ²„κΉ… μ—­λ‰μ΄ ν–¥μƒλ¨.

ν‘μ—…/μ†ν†µ: λ³µμ΅ν• μ„¤μ •μ„ λ‹¨μν™”ν•μ—¬ κ΄€λ¦¬ν•λ” κµ¬μ΅°(SSL Termination)μ μ¤‘μ”μ„±μ„ μ²΄κ°ν•¨.

π€ Action Plan
λ¶€μ΅±ν• μ : openssl λ…λ Ήμ–΄μ μµμ…λ“¤μ΄ μ•„μ§ μµμ™ν•μ§€ μ•μ.

κ°μ„  λ°©μ•: μ£Όμ” μµμ…λ“¤(-x509, -nodes, -subj λ“±)μ μλ―Έλ¥Ό λ‹¤μ‹ μ •λ¦¬ν•  κ²ƒ.

λ‚΄μΌμ λ©ν‘: HAProxyμ ν†µκ³„ νμ΄μ§€(Stats)λ¥Ό ν™μ„±ν™”ν•μ—¬ νΈλν”½ μ μ… ν„ν™©μ„ μ‹κ°μ μΌλ΅ λ¨λ‹ν„°λ§ν•΄λ³΄κΈ°.

π“ 5. λ©”νƒ€μΈμ§€ μΈ΅μ •
π― μ¤λμ ν•™μµ μ μ
μκΈ° κ°κ΄€ν™” μ μ: β­ 9/10

μ΄μ : νΈλ¬λΈ”μν… κ³Όμ •μ„ ν†µν•΄ ν¬νΈ μ μ μ™€ μ„λΉ„μ¤ κµ¬μ΅°λ¥Ό μ™„λ²½ν μ΄ν•΄ν–μΌλ‚, μ΄κΈ° μΈμ¦μ„ κ²½λ΅ μ„¤μ •μ—μ„ λ‹¤μ† μ‹κ°„μ΄ μ†μ”λ¨.


---