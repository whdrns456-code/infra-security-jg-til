# 📅 TIL: 2026-02-14

## 📝 1. 보안 최적화 DB작성
- **주요 주제: 보안을 적용할 은영 프로젝트에 DB를 만들어 보았다 3NF** 
- **핵심 개념 :** 

-- 1. 회원 테이블 (보호자 및 관리자)
CREATE TABLE USERS (
    USER_NO        VARCHAR2(11)    NOT NULL, -- 내부 관리용 키 (예: 20260214001)
    USER_ID        VARCHAR2(20)    NOT NULL, -- 로그인 아이디
    USER_PW        VARCHAR2(255)   NOT NULL, -- BCrypt 암호화된 비밀번호
    USER_NAME      VARCHAR2(50)    NOT NULL, -- 이름
    USER_EMAIL     VARCHAR2(100)   NOT NULL UNIQUE, -- 이메일 (SMTP 인증용)
    USER_PHONE     VARCHAR2(13)    NOT NULL, -- 휴대폰 번호 (예약용)
    USER_ROLE      VARCHAR2(10)    DEFAULT 'USER', -- 권한 (USER, ADMIN,EMP)
    FAIL_COUNT     NUMBER          DEFAULT 0,    -- 비번 실패 횟수
    ACCOUNT_STATUS VARCHAR2(10)    DEFAULT 'ACTIVE', -- 계정 상태
    LOCK_UNTIL     TIMESTAMP,                -- 잠금 해제 시간
    CREATED_AT     DATE            DEFAULT SYSDATE,
    CONSTRAINT PK_USERS PRIMARY KEY (USER_NO),
    CONSTRAINT UK_USER_ID UNIQUE (USER_ID)
);

-- 2. 어르신 테이블
CREATE TABLE SENIORS (
    SENIOR_NO      VARCHAR2(11)    NOT NULL, -- 어르신 고유 번호(조합 미정)
    SENIOR_NAME    VARCHAR2(50)    NOT NULL, -- 어르신 성함
    BIRTH_DATE     VARCHAR2(8)     NOT NULL, -- 생년월일 (YYYYMMDD)
    FLOOR_INFO      VARCHAR2(5),             -- 생활실 정보
    REGISTER_ID    VARCHAR2(11)    NOT NULL, -- 등록한 직원/보호자 고유번호(USER_NO)
    CONSTRAINT PK_SENIORS PRIMARY KEY (SENIOR_NO),
    CONSTRAINT FK_USERS_TO_SENIORS FOREIGN KEY (REGISTER_ID) REFERENCES USERS (USER_NO)
);

-- 3. 어르신-보호자 관계 테이블
CREATE TABLE SENIOR_RELATIONS (
    USER_NO        VARCHAR2(11)    NOT NULL, -- 보호자 고유번호
    SENIOR_NO      VARCHAR2(11)    NOT NULL, -- 어르신 고유번호
    RELATION_TYPE  VARCHAR2(50),             -- 관계 (부, 모, 조부, 자녀 여부)
    CONSTRAINT PK_SENIOR_RELATIONS PRIMARY KEY (USER_NO, SENIOR_NO), -- 복합키 
    CONSTRAINT FK_USERS_TO_REL FOREIGN KEY (USER_NO) REFERENCES USERS (USER_NO),
    CONSTRAINT FK_SENIORS_TO_REL FOREIGN KEY (SENIOR_NO) REFERENCES SENIORS (SENIOR_NO)
);
-- 4. 면회 및 외박 예약 테이블
CREATE TABLE RESERVATIONS (
    RES_NO         VARCHAR2(15)    PRIMARY KEY, -- 예약 고유번호 (예: RES20260214001)
    USER_NO       VARCHAR2(11)    NOT NULL,    -- 신청 보호자 (FK)
    SENIOR_NO    VARCHAR2(11)    NOT NULL,    -- 대상 어르신 (FK)
    RES_TYPE       VARCHAR2(10)    CHECK (RES_TYPE IN ('VISIT', 'OUTING','STAY')), -- 면회/외박/외출
    START_DATE    VARCHAR2(15)       NOT NULL,    -- 면회 시작 시간
    END_DATE       VARCHAR2(15)       NOT NULL,    -- 종료(귀원) 예정 일시(외출과 외박 이용)
    APPLICANT_TEL  VARCHAR2(13)    NOT NULL,    -- 예약자 연락처
    RES_STATUS     VARCHAR2(15)    DEFAULT 'PENDING', -- PENDING, CONFIRMED, CANCELED
    REMARK          VARCHAR2(500),               -- 행선지나 사유 (외출/외박 시 필수)
    CREATED_AT     VARCHAR2(15)            DEFAULT SYSDATE,

    
    CONSTRAINT FK_RES_USER FOREIGN KEY (USER_NO) REFERENCES USERS(USER_NO),
    CONSTRAINT FK_RES_SENIOR FOREIGN KEY (SENIOR_NO) REFERENCES SENIORS(SENIOR_NO),
    -- [보안/무결성] 동일한 어르신에게 같은 시간에 예약이 겹치지 않도록 방지
    CONSTRAINT UK_SENIOR_RESERVATION UNIQUE (SENIOR_NO, START_DATE)
);

-- 5. 보안 및 IP 로그 테이블
CREATE TABLE SECURITY_LOGS (
    LOG_NO         NUMBER          GENERATED AS IDENTITY PRIMARY KEY 
    IP_ADDRESS     VARCHAR2(45)    NOT NULL,    -- 접속 IP
    ATTEMPT_ID     VARCHAR2(50),                -- 로그인 시도 아이디
    ACTION_TYPE    VARCHAR2(20)    NOT NULL,    -- LOGIN_FAIL, ACCESS_DENY 등
    IS_BLOCKED     VARCHAR2(1)         DEFAULT 'N' CHECK (IS_BLOCKED IN ('Y', 'N')),
    LOG_MESSAGE    VARCHAR2(500),               -- 상세 내용
    CREATED_AT     VARCHAR2(15)       DEFAULT CURRENT_TIMESTAMP
);

-- 6. 허니팟 공격 감지 테이블
CREATE TABLE HONEYPOT_LOGS (
    HP_LOG_NO      NUMBER          GENERATED AS IDENTITY PRIMARY KEY,
    ATTACKER_IP    VARCHAR2(45)    NOT NULL,    -- 공격자 IP
    ATTEMPT_PATH   VARCHAR2(200),               -- 시도한 경로 (location 정보 전달)
    INPUT_DATA     CLOB,                        -- 공격자가 날린 데이터 (SQL 인젝션 등)[clob 데이터가 잘 먹는 경우가 있는데 고민중]
    USER_AGENT     VARCHAR2(500),               -- 공격 도구 정보
    CREATED_AT     VARCHAR2(15)       DEFAULT CURRENT_TIMESTAMP
);




---

## 💻 2. 실습 및 구현 내용
### ✅ 실습 목표
- 

### 🛠️ 구현 결과
```language
// 코드를 입력하세요
```

### ✨ 새롭게 알게 된 점
- 

---

## 🛠️ 3. 트러블슈팅 (Troubleshooting)
### 🔍 문제 발생 (Issue)
- **상황:** 
- **에러 메시지:** `Error`

### 💡 원인 분석 (Cause)
- 

### 🚀 해결 방법 (Solution)
- 

---

## 🧐 4. 오늘의 회고
### 💡 성찰 및 성장
- **습득 지식:** 
- **협업/소통:** 

### 🚀 Action Plan
- **부족한 점:** 
- **개선 방안:** 
- **내일의 목표:** 

---

## 📊 5. 메타인지 측정
### 🎯 오늘의 학습 점수
- **자기 객관화 점수:** ⭐ 0/10
- **이유:** 

---

### 🤝 공유 및 토론
- **참고 자료:** 
- **궁금한 점:** 