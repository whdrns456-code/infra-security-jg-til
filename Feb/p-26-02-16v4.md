# 📅 TIL: 2026-02-16

## 📝 1. 오늘의 학습 주제: RBAC + ABAC 하이브리드 접근 제어

### 🛡️ 1. 권한 모델 선택의 이유: 왜 ABAC인가?
- **RBAC(Role-Based Access Control)의 한계**: 
  - 단순히 '보호자'라는 역할(Role)만으로는 충분하지 않다. 
  - 역할 기반으로만 권한을 주면, A 보호자가 B 보호자의 가족 정보를 조회/수정할 수 있는 보안 허점이 발생한다 (IDOR 취약점).
- **보안 대책**: **ABAC(Attribute-Based Access Control)** 도입
  - **주체 속성(User_ID)**과 **자원 속성(Register_ID)**이 일치하는 경우에만 접근을 허용하는 '속성 기반 제어'를 통해 **최소 권한 원칙(Principle of Least Privilege)**을 실현함.

### ⚙️ 2. 상세 접근 권한 설계 (Linux Permission 구조 차용)
- **관리자 (7)**: 시스템 전체 리소스에 대한 READ/WRITE/EXECUTE 권한.
- **직원 (4)**: 면회 일정을 확인하고 관리하기 위한 READ 권한.
- **등록 가입자 (ABAC 적용)**: 본인이 등록한 어르신(가족) 데이터에 대해서만 모든 권한(7)을 가짐. 그 외 데이터는 접근 불가(0).
- **미등록 가입자 (0)** : 모든 접근 및 실행이 불가능하다. 
- **미가입자 (0)**: 모든 접근 및 실행 불가능.


### 🔐 3. 데이터 소유권 선점 및 무결성 보호
- **매칭 로직의 보안성**: 
  - 이름과 생년월일이 명단과 일치하더라도, 이미 `REGISTER_ID`가 존재하는 경우 등록을 거부함.
  - 이를 통해 **데이터 가로채기(Hijacking)**를 방지하고, 1:1 매칭 관계의 **데이터 무결성**을 보장함.
- **서버 사이드 검증**: 
  - 클라이언트의 요청을 그대로 믿지 않고, 서버에서 직접 DB의 속성값을 비교 검증하여 **우회 공격**을 차단함.

- 남은 취약점 : 
- 무차별 대입 공격 (Brute-forcing)
    - 생년월일과 이름 조합을 통해서 무차별적으로 입력을 한다면 해당 위협이 존재하게 된다.  
    - 대응 방안 : 현재 고민하는 방법은 2차 인증 혹은 횟수 제한이다. 
    - 둘 다 무차별 대입 공격을 방지하기에는 좋은 방법이다

- 동시성 이슈 (Race Condition)
    - `senior.getRegisterUser() == null`
    - 찰나의 순간에 위 조건을 통과해버리면 마지막에 save 한 가입자가 데이터를 덮어쓸 수 있게된다.  

- 정보 노출 (Information Disclosure)
    - 사용자 편의성을 위해서 조건에 일치하는 어르신이 이미 등록된 상태  
    - `이미 등록된 어르신입니다.` 라는 메세지를 보게 된다. 
    - 일치하는 어르신이 없다면 `조건에 일치하는 어르신이 없습니다.`라는 메세지를 보내고 있다  
  
- 해당 문제점은 추론[inference] 위협이 된다. 
- 이미 등록이 된 어르신이라는 메세지는 해당 어르신이 이쪽 요양원에 계시는구나 라는 
- 추론을 가능하게 만들어준다. 사용자 편의성을 고려를 한답시고 저러한 메세지를 보내고 있지만
- 사용자 편의성과 보안성 중에서 선택을 하거나 다른 대안을 생각 중이다. 
 
- 그 외 고민하는 점 
- 다중 보호자 허용 (매핑 테이블 도입)
    - 한 부모님에게는 여러 자식이 존재 혹은 다수의 친인척 및 지인 여부   
    - 이 부분은 권한 오남용 및 무분별한 매칭이 이루어 진다. 
    - 지금 내가 가장 크게 고민을 하고 있는 부분이다 어떻게 이 부분을 풀어갈 수 있을까라는 
  
--- 
- ## 내 생각 끄적끄적 ##   

요양원에는 다양한 사람들이 모인다. 모든 사회 구성도 똑같다고는 하지만   
내 생각으로는 조금 더 내면을 보게 되는 것 같다   
가난하지만 매일 부모님을 뵈러 오는 사람  
몸이 아파도 오는 사람 내 친가족이 아니어도 오는 사람  손녀, 며느리, 친척, 친구
그렇다고 항상 모두가 오는 건 아니다 일평생 오지 않는 보호자도 존재한다. 
나는 적어도 전자와 같은 사람들을 위해서 `보안과 편의성`을 중심으로 한 프로그램을 만들고 싶다  
하지만 __보안__ 은 __닫아야 하고__,   
__편의성은 열어야 하기에__ 두 가치는 서로 다른 얼굴을 하고 있다.   
그 사이에서 어떤 선택을 해야 할지 고민이 깊어진다.

---

## 💻 2. 실습 및 구현 내용
### ✅ 실습 목표
- 

### 🛠️ 구현 결과
```language
// 코드를 입력하세요
```

### ✨ 새롭게 알게 된 점
- 

## 🛠️ 3. 트러블슈팅 (Troubleshooting)
### 🔍 문제 발생 (Issue)
- **상황:** 어르신 등록 시 서버 로직은 정상 작동하여 DB는 업데이트되지만, 브라우저 화면이 하얗게 변하며 `success`라는 텍스트만 출력되는 현상 발생.
- **에러 메시지:** 브라우저 주소창이 `/mypage/register-senior`로 변하며 화면 전체에 문자열만 렌더링됨.

### 💡 원인 분석 (Cause)
- HTML `<form>` 태그에 `id` 속성이 누락되어 자바스크립트가 해당 폼의 이벤트를 캡처하지 못함.
- 그 결과 `e.preventDefault()`가 실행되지 않아 브라우저의 기본 제출(Submit)이 발생했고, 서버의 `@ResponseBody` 응답을 새 페이지의 내용으로 인식함.

### 🚀 해결 방법 (Solution)
- `<form>` 태그에 `id="registerForm"`을 추가하여 자바스크립트가 제어할 수 있도록 수정.
- `fetch` API 응답 후 `alert` 및 `confirm`을 통해 페이지 전환 없는 피드백 로직 구현.

---

## 🧐 4. 오늘의 회고
### 💡 성찰 및 성장
- **습득 지식:** RBAC와 ABAC를 결합한 하이브리드 접근 제어 모델의 실무 적용법을 익힘. 상세한 에러 메시지가 '추론(Inference) 위협'이라는 기밀성 침해로 이어질 수 있다는 보안적 트레이드 오프(Trade-off)를 이해함.
- **협업/소통:** 기술은 단순히 데이터를 잠그는 것이 아니라, 소중한 관계를 지키는 울타리가 되어야 한다는 점을 배움. 보안과 편의성 사이의 균형이 곧 사용자(보호자)에 대한 배려임을 깨달음.

### 🚀 Action Plan
- **부족한 점:** 상세한 피드백(편의성)과 정보 은닉(보안) 사이에서 최적의 메시지 수위를 결정하는 판단력.
- **개선 방안:** 실제 서비스 환경을 고려하여, 중요 정보는 은닉하되 사용자가 다음 행동을 할 수 있도록 돕는 '친절한 보안 메시지' 설계 패턴 연구.
- **내일의 목표:** 등록된 어르신 정보를 마이페이지 메인에 동적으로 출력하고, 실제 면회 예약 저장 기능 구현하기.

---

## 📊 5. 메타인지 측정
### 🎯 오늘의 학습 점수
- **자기 객관화 점수:** ⭐ 9/10
- **이유:** 발생한 버그의 원인을 통신 구조(Request/Response) 관점에서 정확히 파악했으며, 구현한 로직이 어떤 보안 위협(추론 공격)에 노출될 수 있는지 이론적으로 연결하여 정리함.

---

### 🤝 공유 및 토론
- **참고 자료:** Spring Security ABAC 정석 가이드, 개인정보 보호를 위한 에러 메시지 설계 지침.
- **궁금한 점:** 사용자가 중복 클릭을 할 경우 서버에서 발생할 수 있는 '동시성 이슈'를 DB 레벨(Lock)에서 해결하는 구체적인 방법론.